<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="style.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>
<body class="bg">

<header>
    <a href="#" class="name">HUNTRIX</a>
    <div class="menu-btn"></div>
    <div class="nav">
        <div class="nav-items">
            <a href="index.html">Home</a>
            <a href="character.html" target="_blank">Characters</a>
            <a href="Gallery.html" target="_blank">Gallery</a>
            <a href="#">Songs</a>
            <a href="about.html">About</a>
            <button> Download</button>
        </div>
    </div>
        <i class="fa fa-bars ham" id="openMenu"></i>
        <i class="fa fa-times " id="closeMenu"></i>
    
</header>
    <div class="wrapper">
  <form id="loginForm">
    <h1>Login</h1>
    <div class="input-box">
      <input type="text" placeholder="Username" required name="username">
    </div>
    <div class="input-box">
      <input type="password" placeholder="Password" required name="password">
    </div>
    <button type="submit" class="btn">Login</button>
    <div class="reglink">
      <p>Don't have an account? <a href="register.html">Register here!</a></p>
    </div>
  </form>
</div>
    <script>

 const openMenu = document.getElementById('openMenu');
const closeMenu = document.getElementById('closeMenu');
const navItems = document.querySelector('.nav-items');

// Show menu
openMenu.addEventListener('click', () => {
  navItems.classList.add('active');
  openMenu.style.display = 'none';
  closeMenu.style.display = 'block';
});

// Hide menu
closeMenu.addEventListener('click', () => {
  navItems.classList.remove('active');
  closeMenu.style.display = 'none';
  openMenu.style.display = 'block';
});

// Optional: Close if nav item is clicked
navItems.addEventListener('click', (e) => {
  if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON') {
    navItems.classList.remove('active');
    closeMenu.style.display = 'none';
    openMenu.style.display = 'block';
  }
});
 console.log("Login script loaded ✅");

function hasSelectedCharacter() {
  try {
    const sc = JSON.parse(localStorage.getItem("selectedCharacter") || "null");
    return !!sc;
  } catch (e) { return false; }
}

document.getElementById("loginForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const form = e.target;
  const username = form.username.value.trim();
  const password = form.password.value;

  if (!username || !password) {
    alert("Please enter username and password.");
    return;
  }

  const submitBtn = form.querySelector('button[type="submit"]');
  submitBtn.disabled = true;
  submitBtn.textContent = "Logging in...";

  try {
    const res = await fetch("https://huntrix-backend-0a1b.onrender.com/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.error || "Login failed — check credentials or server.");
      return;
    }

    const user = { username, id: data.userId };
    localStorage.setItem("loggedInUser", JSON.stringify(user));
    localStorage.setItem("currentUser", username);

    if (hasSelectedCharacter()) {
      window.location.href = "dashboard.html";
    } else {
      window.location.href = "character-select.html";
    }

  } catch (err) {
    console.error("Login error:", err);
    alert("❌ Could not contact server. Try again later.");
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = "Login";
  }
});
    </script>

</body>
</html>